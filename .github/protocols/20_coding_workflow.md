# 🔄 000AI 编码工作流规范 (v3.0)

## 🔄 开发生命周期 (6步状态机)
### 1. 🗺️ 计划 (Plan) `<plan>`
*   **操作**:
    *   **上下文解析**: 识别 `<ProjectName>` (例如 `Web_compute_low`)。
    *   **规范执行**: 必须执行:
        *   ✅ **交互**: 使用 `10_runtime_safety.md` 中的 **自动输入交互指令** 处理所有命令。
        *   ✅ **日志**: 使用 `10_runtime_safety.md` 中的 **进度追踪日志** 记录状态。
        *   ✅ **创建**: 遵循 `10_runtime_safety.md` 中的 **测试文件创建规范** 管理文件。
    *   **任务拆解**: 将用户提示拆解为原子任务。
*   **输出**: `<plan> ... </plan>`

### 2. 📐 逻辑 (Logic) `<logic>`
*   **规则**: **逻辑先行，代码在后**。
*   **操作**:
    *   **草稿**: 对于复杂任务 (>50行 或 >2文件)，先写(伪代码/流程图/架构)。
*   **禁止**: 此阶段禁止编写可执行代码。
*   **语法卫士**: 
    *   `.py`: `#`
    *   `.js/.ts/.c/.cpp`: `//` 或 `/* */`
    *   `.bat`: `REM` (块内禁止使用 `::`)
*   **输出**: `<logic> ... </logic>`

### 3. ⌨️ 编码 (Code) `<code_action>`
*   **标准**: **高密度，原子化代码**。
*   **验证**: 完成前运行 `get_errors` (Linter)。
*   **禁止**: **禁止注释** (TODO 除外)。
*   **输出**: `<code_action> ... </code_action>`

### 4. ⚡ 测试 (Test) `<test_action>`
*   **规则**: **静默执行**。
*   **操作**: 运行测试脚本，捕获 stdout/stderr。
*   **强制**: 使用 **非交互** 标志 (例如 `< nul`)。
*   **输出**: `<test_action> ... </test_action>`

### 5. 🧠 反思 (Reflexion) `<reflexion>`
*   **触发**: 测试完成或失败。
*   **操作**: 分析根本原因。
*   **决策**:
    *   **失败**: 返回 `<logic>` 或 `<code_action>`。
    *   **通过**: 进入 `<annotation_action>`。
*   **输出**: `<reflexion> ... </reflexion>`

### 6. 📝 注释 (Annotation) `<annotation_action>`
*   **触发**: 仅在 **最终验证** 后。
*   **任务**: **逆向工程与注释注入**。
*   **操作**: 使用 `replace_string_in_file` 必须应用 **注释标准**。
*   **语言**: 简体中文 (zh-cn)。
*   **输出**: `<annotation_action> ... </annotation_action>`

### 7. ✅ 完成  `<completion>`
*   **触发**: 必须在 **注释 (Annotation)** 完成后，才能结束任务。

## 📜 注释标准
**A. 文件头**
*   **位置**: 文件顶部。
*   **格式**:
    ```text
    /* ==========================================================================
       📃 文件功能 : [描述]
       ⚡ 逻辑摘要 : [核心算法/流程]
       💡 易懂解释 : [易于理解的解释，积极语气]
       🔋 未来扩展 : [扩展建议]
       📊 当前状态 : [活跃 | 待定 | 完成 | 废弃] (更新: YYYY-MM-DD)
       🧱 [文件名] 踩坑记录 (累积，勿覆盖) :
          1. [YYYY-MM-DD] [已修复/待定] [问题]: [原因] -> [修复] (Line XX)
       ========================================================================== */
    ```

**B. 五段式块 (函数/类/模块)**
*   **位置**: 定义内部。
*   **格式**:
```text
// =============================================================================
//  🎉 [中文名称] ([参数名], [参数名]...)
//
//  🎨 用途:
//      [技术描述]
//
//  💡 易懂解释:
//      [易于理解的解释，积极语气]
//  
//  ⚠️ 警告:
//      [风险类型]: [后果与修复]
//      (例如: 死锁, 内存泄漏。若无, "无特殊风险")
//  
//  ⚙️ 触发源:
//      [文件/模块] -> [UI/事件] -> [函数链]
// =============================================================================
```

**C. 📍 视觉状态信标 (行内)**
*   **概念**: 使用 Emoji 将代码逻辑映射为人类可读状态。
*   **覆盖率**: **100%** (除纯括号外的每一行)。
*   **内容**: **状态/结果导向**。
    *   描述 "状态变化" 或 "业务结果"。
    *   无废话。名词为主。
*   **语法**: `.py` (#), `.js` (//), `.bat` (REM), `.html` (<!-- -->)。
*   **示例**:
```python
def calculate_score(points):
    # ... (五段式块) ...
    current_score = 0  # 🥚 基础分重置
    if points > 10:    # ⚖️ 高分阈值
        current_score = points * 2  # 🚀 双倍奖励激活
    return current_score # 📤 结果交付
```
