# 🔄 000AI 编码工作流规范 (v3.0)

## 🔄 开发生命周期 (6步状态机)
### 1. 🗺️ 计划 (Plan) `<plan>`
*   **操作**:
    *   **上下文解析**: 识别 `<ProjectName>` (例如 `Web_compute_low`)。
    *   **规范执行**: 必须执行:
        *   ✅ **交互**: 使用 `10_runtime_safety.md` 中的 **自动输入交互指令** 处理所有命令。
        *   ✅ **日志**: 使用 `10_runtime_safety.md` 中的 **进度追踪日志** 记录状态。
        *   ✅ **创建**: 遵循 `10_runtime_safety.md` 中的 **测试文件创建规范** 管理文件。
    *   **任务拆解**: 将用户提示拆解为原子任务。
    *   **语法卫士**: 
    *   `.py`: `#`
    *   `.js/.ts/.c/.cpp`: `//` 或 `/* */`
    *   `.bat`: `REM` (块内禁止使用 `::`)
*   **输出**: `<plan> ... </plan>`

### 2. 📐 逻辑 (Logic) `<logic>`
*   **规则**: **逻辑先行，代码在后**。
*   **操作**:
    *   **草稿**: 对于复杂任务 (>50行 或 >2文件)，先写(伪代码/流程图/架构)。
    *   **细化**: 将草稿细化为高评分逻辑。
*   **输出**: `<logic> ... </logic>`

### 3. ⌨️ 编码 (Code) `<code_action>`
*   **标准**: **高评分，原子化代码**。
*   **目标**: 逻辑评分极高。
*   **验证**: 完成前运行 `get_errors` (Linter)。
*   **禁止**: **禁止注释** (TODO 除外)。
*   **输出**: `<code_action> ... </code_action>`

### 4. ⚡ 测试 (Test) `<test_action>`
*   **规则**: **静默执行**。
*   **操作**: 运行测试脚本，捕获 stdout/stderr。
*   **强制**: 使用 **非交互** 标志 (例如 `< nul`)。
*   **输出**: `<test_action> ... </test_action>`

### 5. 🧠 反思 (Reflexion) `<reflexion>`
*   **触发**: 测试完成或失败。
*   **操作**: 分析Why(根本原因)。
*   **决策**:
    *   **失败**: 返回 `<logic>` 或 `<code_action>`。
    *   **通过**: 进入 `<annotation_action>`。
*   **输出**: `<reflexion> ... </reflexion>`

### 6. 📝 注释 (Annotation) `<annotation_action>`
*   **触发**: 仅在 **最终验证** 后。
*   **任务**: **逆向工程与注释注入**。
*   **操作**: 使用 `replace_string_in_file` 必须应用 **注释标准**。
*   **语言**: 简体中文 (zh-cn)。
*   **严格**: 若单文件超100行，分多次注释。严禁偷懒。禁止遗漏。
*   **输出**: `<annotation_action> ... </annotation_action>`

### 7. ✅ 完成  `<completion>`
*   **触发**: 必须在 **注释 (Annotation)** 完成后，才能结束任务。

## 📜 注释标准
**A. 文件注释**
*   **位置**: 文件顶部。
*   **格式**:
    ```text
    /* ==========================================================================
       📃 文件功能 : [写全]
       ⚡ 逻辑摘要 : [核心算法/思路]
       💡 易懂解释 : [高中生能懂，正面可爱语气，不使用比喻]
       🔋 未来扩展 : [未来扩展建议]
       📊 当前状态 : [活跃 | 待定 | 完成 | 废弃] (更新: YYYY-MM-DD)
       🧱 [文件名] 踩坑记录 (累积，勿覆盖) :
          1. [YYYY-MM-DD] [已修复/待验证] [问题]: [原因] -> [修复] (Line XX)
       ========================================================================== */
    ```

**B. 五段式块 (函数/类/模块)**
*   **位置**: 定义行的下一行（内部）。
*   **格式**:
```text
// =============================================================================
//  🎉 [中文含义] ([参数的中文含义]，[参数的中文含义]，[参数的中文含义]，...)
//
//  🎨 代码用途：
//      [专业描述：精准的编程术语，描述这段代码的技术目，但要易懂]
//
//  💡 易懂解释:
//      [高中生能懂，正面可爱语气，不使用比喻]
//  
//  ⚠️ 警告:
//      [风险类型]: [具体后果与解决方案]
//  
//  ⚙️ 触发源:
//      [必须用，例如：通过 admin_panel.js 后台管理系统的 “强制结算” 按钮 handle_click -> Admin_Force_Settle函数触发]
// =============================================================================
```

**C. 📍 视觉状态信标 (行内)**
*   **概念**: 使用正面的 Emoji 将代码逻辑映射为人类可读状态。
*   **覆盖率**: **100%** (除纯括号外)每一行代码必须有信标。
*   **内容**: **状态/结果导向**。
    *   侧重描述代码执行后的 **状态变化** 或 **业务结果**。
    *   **风格**: 词汇偏名词化，简洁有力。必须不超4个词。
    *   **严禁**使用逗号、长句等废话。
*   **语法适配**:自动适配 `.py` (#), `.js` (//), `.bat` (REM), `.html` (<!-- -->)。
*   **示例**:
```python
def calculate_score(points):
    # ... (五段式块) ...
    current_score = 0  # 🥚 基础分重置
    if points > 10:    # ⚖️ 高分阈值判定
        current_score = points * 2  # 🚀 双倍奖励生效
    return current_score # 📤 结果交付
```
