# ==========================================================================
#  ğŸ“ƒ æ–‡ä»¶åŠŸèƒ½ : Python æœåŠ¡å…¥å£
#  âš¡ é€»è¾‘æ‘˜è¦ : å¯åŠ¨ FastAPI æœåŠ¡å™¨ï¼ŒæŒ‚è½½è·¯ç”±ï¼Œå¯åŠ¨åå°ä»»åŠ¡ã€‚
#  ğŸ’¡ æ˜“æ‡‚è§£é‡Š : Python ä¾§çš„ "main å‡½æ•°"ï¼Œç¨‹åºçš„èµ·ç‚¹ã€‚
#  ğŸ”‹ æœªæ¥æ‰©å±• : æ”¯æŒå‘½ä»¤è¡Œå‚æ•°é…ç½®ç«¯å£ï¼Œæ”¯æŒå¤šè¿›ç¨‹å¯åŠ¨ã€‚
#  ğŸ“Š å½“å‰çŠ¶æ€ : æ´»è·ƒ (æ›´æ–°: 2025-12-06)
#  ğŸ§± Brain/Main.py è¸©å‘è®°å½• (ç´¯ç§¯ï¼Œå‹¿è¦†ç›–) :
#     1. [2025-12-04] [å·²ä¿®å¤] [æ¨¡å—å¯¼å…¥]: æ‰¾ä¸åˆ° Memory æ¨¡å—ã€‚ -> ä½¿ç”¨ sys.path.append æ·»åŠ çˆ¶ç›®å½•ã€‚
# ==========================================================================

import asyncio
import uvicorn
import sys
import os
from fastapi import FastAPI

# ğŸ› ï¸ ç¡®ä¿èƒ½å¯¼å…¥åŒçº§æ¨¡å— (Body, Memory, Energy)
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__)))) # ğŸ“‚ æ·»åŠ çˆ¶ç›®å½•

from Memory.Interface import router
from Energy.Tasks import cost_sync_loop

# =============================================================================
#  ğŸ‰ åº”ç”¨å®ä¾‹
#
#  ğŸ¨ ä»£ç ç”¨é€”:
#      Web æœåŠ¡å™¨æ ¸å¿ƒå¯¹è±¡ã€‚
#
#  ğŸ’¡ æ˜“æ‡‚è§£é‡Š:
#      è¿™æ˜¯æˆ‘ä»¬çš„ Python æœåŠ¡å¤§æœ¬è¥ï¼
#
#  âš ï¸ è­¦å‘Š:
#      [ç«¯å£å†²çª]: è¿è¡Œåœ¨ 8001 ç«¯å£ï¼ŒRust Core è¿è¡Œåœ¨ 8000 ç«¯å£ã€‚
#
#  âš™ï¸ è§¦å‘æº:
#      Through Brain/Main.py "Module Load" -> app
# =============================================================================
app = FastAPI(title="Angel Python Worker", version="4.0.0") # ğŸš€ åˆ›å»ºå®ä¾‹
app.include_router(router) # ğŸ›£ï¸ æ³¨å†Œè·¯ç”±

@app.on_event("startup")
async def start_background_tasks():
    # =============================================================================
    #  ğŸ‰ å¯åŠ¨åå°ä»»åŠ¡
    #
    #  ğŸ¨ ä»£ç ç”¨é€”:
    #      æœåŠ¡å™¨å¯åŠ¨æ—¶è¿è¡Œçš„é’©å­ã€‚
    #
    #  ğŸ’¡ æ˜“æ‡‚è§£é‡Š:
    #      å¼€é—¨è¥ä¸šå•¦ï¼å…ˆæŠŠåå°ä»»åŠ¡è·‘èµ·æ¥ï¼
    #
    #  âš ï¸ è­¦å‘Š:
    #      [é˜»å¡é£é™©]: ä¸è¦åœ¨è¿™é‡Œè¿è¡Œé˜»å¡ä»£ç ï¼Œä½¿ç”¨ asyncio.create_taskã€‚
    #
    #  âš™ï¸ è§¦å‘æº:
    #      Through Brain/Main.py "Server Startup" -> start_background_tasks
    # =============================================================================
    asyncio.create_task(cost_sync_loop()) # ğŸ”„ å¯åŠ¨æˆæœ¬åŒæ­¥

if __name__ == "__main__":
    print("ğŸ [Main] Python Service å¯åŠ¨ä¸­ (Port 8001)...") # ğŸ“¢ æ‰“å°å¯åŠ¨ä¿¡æ¯
    uvicorn.run(app, host="0.0.0.0", port=8001) # ğŸŒ å¯åŠ¨æœåŠ¡å™¨
