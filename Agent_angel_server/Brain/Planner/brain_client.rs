/* ==========================================================================
   ğŸ“ƒ æ–‡ä»¶åŠŸèƒ½ : Python å¤§è„‘é€šä¿¡å®¢æˆ·ç«¯
   âš¡ é€»è¾‘æ‘˜è¦ : è´Ÿè´£å°†æ„ŸçŸ¥æ•°æ® (æˆªå›¾ã€URL) å‘é€ç»™ Python ç«¯ (Gemini/Playwright)ï¼Œå¹¶æ¥æ”¶å†³ç­–ç»“æœã€‚
   ğŸ’¡ æ˜“æ‡‚è§£é‡Š : è¿™æ˜¯è¿æ¥ "å°è„‘" (Rust) å’Œ "å¤§è„‘" (Python) çš„ç”µè¯çº¿ã€‚
   ğŸ”‹ æœªæ¥æ‰©å±• : æ”¯æŒ gRPC ä»¥æé«˜ä¼ è¾“æ•ˆç‡ã€‚
   ğŸ“Š å½“å‰çŠ¶æ€ : æ´»è·ƒ (æ›´æ–°: 2025-12-06)
   ğŸ§± Brain/Planner/brain_client.rs è¸©å‘è®°å½• (ç´¯ç§¯ï¼Œå‹¿è¦†ç›–) :
      1. [2025-12-04] [å·²ä¿®å¤] [è¶…æ—¶é—®é¢˜]: Python å¤„ç†å›¾ç‰‡è¾ƒæ…¢ï¼Œéœ€å¢åŠ è¶…æ—¶æ—¶é—´ã€‚ -> æš‚æœªå¤„ç†ï¼Œä¾èµ–é»˜è®¤è¶…æ—¶ã€‚
   ========================================================================== */

use reqwest::Client;
use crate::planner::types::{ThinkReq, ThinkResp};

pub async fn call_python_brain(
    client: &Client,
    user_id: &str,
    task: &str,
    url: &str,
    screenshot: &str
) -> Option<ThinkResp> {
    // =============================================================================
    //  ğŸ‰ è°ƒç”¨ Python å¤§è„‘ (å®¢æˆ·ç«¯ï¼Œç”¨æˆ·IDï¼Œä»»åŠ¡ï¼ŒURLï¼Œæˆªå›¾)
    //
    //  ğŸ¨ ä»£ç ç”¨é€”:
    //      æ„é€  HTTP è¯·æ±‚ï¼Œå°†å½“å‰ä¸Šä¸‹æ–‡å‘é€ç»™ Python ç«¯çš„ /think æ¥å£ã€‚
    //
    //  ğŸ’¡ æ˜“æ‡‚è§£é‡Š:
    //      ç»™ Python å¤§è„‘æ‰“ä¸ªç”µè¯ï¼Œé—®é—®å®ƒï¼š"è€æ¿è¦è¿™ä¸ª (task)ï¼Œæˆ‘ç°åœ¨çœ‹åˆ°è¿™ä¸ª (screenshot)ï¼Œå’‹æ•´ï¼Ÿ"
    //
    //  âš ï¸ è­¦å‘Š:
    //      [ç½‘ç»œå»¶è¿Ÿ]: ä¼ è¾“ Base64 å›¾ç‰‡å¯èƒ½å¯¼è‡´è¯·æ±‚ä½“è¾ƒå¤§ï¼Œæ³¨æ„å¸¦å®½ã€‚
    //
    //  âš™ï¸ è§¦å‘æº:
    //      Through Brain/Planner.rs "Decide Phase" -> call_python_brain
    // =============================================================================
    let req = ThinkReq {
        user_id: user_id.to_string(), // ğŸ†” ç”¨æˆ· ID
        task: task.to_string(), // ğŸ“ ä»»åŠ¡æè¿°
        url: url.to_string(), // ğŸŒ å½“å‰ URL
        screenshot: screenshot.to_string(), // ğŸ–¼ï¸ æˆªå›¾æ•°æ®
    };

    // ğŸš€ å‘é€è¯·æ±‚
    let resp = client.post("http://127.0.0.1:8002/think")
        .json(&req) // ğŸ“¦ åºåˆ—åŒ– JSON
        .send()
        .await
        .ok()?; // âš ï¸ å¤±è´¥è¿”å› None

    // ğŸ“¥ è§£æå“åº”
    resp.json::<ThinkResp>().await.ok() // ğŸ“¦ ååºåˆ—åŒ–
}
