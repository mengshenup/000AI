import os # ğŸ“‚ æ“ä½œç³»ç»Ÿæ¥å£
from dotenv import load_dotenv # ğŸ”‘ ç¯å¢ƒå˜é‡åŠ è½½åº“

# =================================
#  ğŸ•µï¸â€â™‚ï¸ ç¯å¢ƒå˜é‡åŠ è½½æ£€æŸ¥å™¨ (æ— å‚æ•°)
#
#  ğŸ¨ ä»£ç ç”¨é€”ï¼š
#     æ¨¡æ‹Ÿä¸»ç¨‹åºçš„é€»è¾‘ï¼Œå°è¯•åŠ è½½ .env æ–‡ä»¶å¹¶æ£€æŸ¥ GEMINI_API_KEY æ˜¯å¦æ­£ç¡®è¯»å–ã€‚
#     ç”¨äºè¯Šæ–­â€œKey æ‰¾ä¸åˆ°â€æˆ–â€œKey æ ¼å¼é”™è¯¯â€çš„é—®é¢˜ã€‚
#
#  ğŸ’¡ æ˜“æ‡‚è§£é‡Šï¼š
#     è¿™æ˜¯ Angel çš„ä½“æ£€åŒ»ç”Ÿï¼ğŸ©º ä¸“é—¨æ£€æŸ¥ Angel çš„èº«ä»½è¯ï¼ˆAPI Keyï¼‰æœ‰æ²¡æœ‰å¸¦åœ¨èº«ä¸Šï¼Œ
#     æˆ–è€…èº«ä»½è¯æ˜¯ä¸æ˜¯è„äº†ï¼ˆæœ‰ç©ºæ ¼/æ¢è¡Œç¬¦ï¼‰ã€‚
# =================================

# æ¨¡æ‹Ÿ fastapi_app.py ä¸­çš„åŠ è½½é€»è¾‘
# ğŸ“ æ„é€  .env è·¯å¾„ (Agent_angel_server/Memorybank/.env)
env_path = os.path.join(os.path.dirname(os.path.dirname(__file__)), "Memorybank", ".env") 
print(f"æ­£åœ¨å°è¯•åŠ è½½ .env æ–‡ä»¶: {env_path}") # ğŸ“¢ æ‰“å°è·¯å¾„

if os.path.exists(env_path): # ğŸ” æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    print("âœ… .env æ–‡ä»¶å­˜åœ¨") # âœ… å­˜åœ¨æç¤º
    with open(env_path, 'r', encoding='utf-8') as f: # ğŸ“‚ è¯»å–æ–‡ä»¶
        content = f.read() # ğŸ“– è¯»å–å†…å®¹
        print(f"ğŸ“„ æ–‡ä»¶å†…å®¹é¢„è§ˆ (å‰50å­—ç¬¦): {content[:50]!r}") # ğŸ‘ï¸ é¢„è§ˆå†…å®¹
        if '\n' in content: # ğŸ” æ£€æŸ¥æ¢è¡Œ
            print("â„¹ï¸ æ–‡ä»¶åŒ…å«æ¢è¡Œç¬¦ (æ­£å¸¸)") # â„¹ï¸ æ­£å¸¸æç¤º
        else:
            print("â„¹ï¸ æ–‡ä»¶ä¸åŒ…å«æ¢è¡Œç¬¦") # â„¹ï¸ å¼‚å¸¸æç¤º
            
    load_dotenv(env_path) # ğŸ”‘ åŠ è½½ç¯å¢ƒå˜é‡
    key = os.getenv("GEMINI_API_KEY") # ğŸ”‘ è·å– Key
    if key: # âœ… æ£€æŸ¥ Key æ˜¯å¦å­˜åœ¨
        print(f"âœ… GEMINI_API_KEY å·²åŠ è½½: {key[:5]}...{key[-5:]} (é•¿åº¦: {len(key)})") # ğŸ“¢ æ‰“å° Key ä¿¡æ¯
        if '\n' in key: # ğŸ” æ£€æŸ¥æ¢è¡Œç¬¦
            print("âš ï¸ è­¦å‘Š: Key ä¸­åŒ…å«æ¢è¡Œç¬¦ï¼") # âš ï¸ è­¦å‘Š
        if '\r' in key: # ğŸ” æ£€æŸ¥å›è½¦ç¬¦
            print("âš ï¸ è­¦å‘Š: Key ä¸­åŒ…å«å›è½¦ç¬¦ï¼") # âš ï¸ è­¦å‘Š
        if key.strip() != key: # ğŸ” æ£€æŸ¥ç©ºç™½å­—ç¬¦
            print("âš ï¸ è­¦å‘Š: Key å‰åæœ‰ç©ºç™½å­—ç¬¦ï¼") # âš ï¸ è­¦å‘Š
    else:
        print("âŒ GEMINI_API_KEY æœªæ‰¾åˆ°") # âŒ æœªæ‰¾åˆ°æç¤º
else:
    print("âŒ .env æ–‡ä»¶ä¸å­˜åœ¨") # âŒ æ–‡ä»¶ä¸å­˜åœ¨æç¤º
