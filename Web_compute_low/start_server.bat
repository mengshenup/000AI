@echo off
:: =================================
::  ğŸ‰ å¯åŠ¨æœåŠ¡å™¨è„šæœ¬ (æ— å‚æ•°)
::
::  ğŸ¨ ä»£ç ç”¨é€”ï¼š
::     åˆå§‹åŒ–ç¯å¢ƒï¼Œæ¸…ç†ç«¯å£å ç”¨ï¼Œå¹¶ä½¿ç”¨ Python å†…ç½®çš„ http.server å¯åŠ¨é™æ€æ–‡ä»¶æœåŠ¡ã€‚
::
::  ğŸ’¡ æ˜“æ‡‚è§£é‡Šï¼š
::     æ‰“å¼€å¤§é—¨ï¼ğŸšª æ¬¢è¿å…‰ä¸´ Angel çš„å®¶ï¼ˆå‰ç«¯é¡µé¢ï¼‰ï¼
:: =================================

chcp 65001 >nul
:: ğŸ“‚ åˆ‡æ¢åˆ°å½“å‰è„šæœ¬æ‰€åœ¨ç›®å½•
cd /d "%~dp0"
:: ğŸ·ï¸ è®¾ç½®çª—å£æ ‡é¢˜
title Angel Web Low (Frontend - 5500)
:: ğŸ¨ è®¾ç½®æ§åˆ¶å°é¢œè‰² (æµ…ç»¿è‰²)
color 0a

echo [å¯åŠ¨] æ­£åœ¨å¯åŠ¨ Angel Web Low (ç«¯å£ 5500)...

:: æ£€æŸ¥ç«¯å£ 5500
:check_port
:: ğŸ” æŸ¥æ‰¾å ç”¨ 5500 ç«¯å£çš„è¿›ç¨‹
netstat -aon | findstr ":5500" >nul
if %errorlevel% equ 0 (
    :: ğŸ”„ å¦‚æœç«¯å£è¢«å ç”¨ï¼Œå¾ªç¯æ¸…ç†
    for /f "tokens=5" %%a in ('netstat -aon ^| findstr ":5500"') do (
        echo [æ¸…ç†] ç«¯å£ 5500 è¢«å ç”¨ï¼ŒPID: %%a
        tasklist /fi "pid eq %%a"
        :: ğŸ”ª å¼ºåˆ¶ç»“æŸè¿›ç¨‹
        taskkill /f /pid %%a >nul 2>&1
    )
    :: â±ï¸ ç­‰å¾… 1 ç§’
    timeout /t 1 >nul
    goto check_port
) else (
    echo [çŠ¶æ€] ç«¯å£ 5500 æœªè¢«å ç”¨ã€‚
)

:: ğŸ æ¿€æ´» Python è™šæ‹Ÿç¯å¢ƒ (ä»…ä¸ºäº†ä½¿ç”¨ python å‘½ä»¤)
if exist "..\.venv\Scripts\activate.bat" call "..\.venv\Scripts\activate.bat"

:: ğŸš€ å¯åŠ¨é™æ€æ–‡ä»¶æœåŠ¡å™¨
python -m http.server 5500
if %errorlevel% neq 0 (
    echo [é”™è¯¯] æ— æ³•å¯åŠ¨ HTTP æœåŠ¡å™¨ (ç«¯å£ 5500)ã€‚
    pause
)
