import json
import os
from pathlib import Path

# ğŸ“‚ å®šä¹‰æ•°æ®å­˜å‚¨ç›®å½•
# ä½¿ç”¨ pathlib åº“æ¥å¤„ç†è·¯å¾„ï¼Œå…¼å®¹ä¸åŒæ“ä½œç³»ç»Ÿ
DATA_DIR = Path("user_data")
# âœ… å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™è‡ªåŠ¨åˆ›å»º
DATA_DIR.mkdir(exist_ok=True)

def save_data(filename: str, data: list | dict):
    # =================================
    #  ğŸ‰ ä¿å­˜æ•°æ® (æ–‡ä»¶åï¼Œæ•°æ®)
    #
    #  ğŸ¨ ä»£ç ç”¨é€”ï¼š
    #     å°†æ•°æ®ä¿å­˜ä¸º JSON æ–‡ä»¶åˆ° user_data ç›®å½•ã€‚
    #
    #  ğŸ’¡ æ˜“æ‡‚è§£é‡Šï¼š
    #     æŠŠå†…å­˜é‡Œçš„ä¸œè¥¿å†™åˆ°ç¡¬ç›˜ä¸Šï¼Œé˜²æ­¢æ–­ç”µä¸¢å¤±ã€‚ğŸ’¾
    #
    #  âš ï¸ è­¦å‘Šï¼š
    #     å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œå°†ä¼šè¢«ç›´æ¥è¦†ç›–ã€‚
    # =================================
    
    # ğŸ”— æ‹¼æ¥å®Œæ•´çš„æ–‡ä»¶è·¯å¾„
    file_path = DATA_DIR / filename
    try:
        # ğŸ“ ä»¥å†™å…¥æ¨¡å¼æ‰“å¼€æ–‡ä»¶ï¼ŒæŒ‡å®š utf-8 ç¼–ç é˜²æ­¢ä¹±ç 
        with open(file_path, 'w', encoding='utf-8') as f:
            # ğŸ“¦ å°† Python å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²å¹¶å†™å…¥æ–‡ä»¶
            # ensure_ascii=False å…è®¸å†™å…¥ä¸­æ–‡ï¼Œindent=2 ä¿æŒç¼©è¿›ç¾è§‚
            json.dump(data, f, ensure_ascii=False, indent=2)
        return True # âœ… ä¿å­˜æˆåŠŸè¿”å› True
    except Exception as e:
        # ğŸš¨ æ‰“å°é”™è¯¯ä¿¡æ¯ï¼Œæ–¹ä¾¿æ’æŸ¥
        print(f"âŒ ä¿å­˜å¤±è´¥ {filename}: {e}")
        return False # âŒ ä¿å­˜å¤±è´¥è¿”å› False

def load_data(filename: str, default=None):
    # =================================
    #  ğŸ‰ è¯»å–æ•°æ® (æ–‡ä»¶åï¼Œé»˜è®¤å€¼)
    #
    #  ğŸ¨ ä»£ç ç”¨é€”ï¼š
    #     ä» user_data ç›®å½•è¯»å– JSON æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¿”å›é»˜è®¤å€¼ã€‚
    #
    #  ğŸ’¡ æ˜“æ‡‚è§£é‡Šï¼š
    #     ä»ç¡¬ç›˜ä¸ŠæŠŠä¹‹å‰å­˜çš„ä¸œè¥¿è¯»å›å†…å­˜é‡Œã€‚ğŸ“–
    #
    #  âš ï¸ è­¦å‘Šï¼š
    #     å¦‚æœæ–‡ä»¶å†…å®¹ä¸æ˜¯åˆæ³•çš„ JSON æ ¼å¼ï¼Œå°†ä¼šæŠ¥é”™å¹¶è¿”å›é»˜è®¤å€¼ã€‚
    # =================================
    
    # ğŸ›¡ï¸ å¦‚æœæ²¡æœ‰æä¾›é»˜è®¤å€¼ï¼Œåˆ™é»˜è®¤ä¸ºç©ºåˆ—è¡¨
    if default is None:
        default = []
        
    # ğŸ”— æ‹¼æ¥å®Œæ•´çš„æ–‡ä»¶è·¯å¾„
    file_path = DATA_DIR / filename
    
    # ğŸ” æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    if not file_path.exists():
        return default # ğŸ”™ ä¸å­˜åœ¨åˆ™è¿”å›é»˜è®¤å€¼
        
    try:
        # ğŸ“– ä»¥è¯»å–æ¨¡å¼æ‰“å¼€æ–‡ä»¶
        with open(file_path, 'r', encoding='utf-8') as f:
            # ğŸ“¦ å°† JSON å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸º Python å¯¹è±¡
            return json.load(f)
    except Exception as e:
        # ğŸš¨ æ‰“å°é”™è¯¯ä¿¡æ¯
        print(f"âŒ è¯»å–å¤±è´¥ {filename}: {e}")
        return default # ğŸ”™ å‡ºé”™æ—¶è¿”å›é»˜è®¤å€¼
