from fastapi import APIRouter # ğŸ›£ï¸ è·¯ç”±ç®¡ç†
from pydantic import BaseModel # ğŸ—ï¸ æ•°æ®æ¨¡å‹éªŒè¯
from Memory.file_manager import FileManager # ğŸ’¾ æ–‡ä»¶ç®¡ç†å™¨

router = APIRouter() # ğŸ›£ï¸ åˆ›å»º HTTP è·¯ç”±
DATA_FILE = "apps.json" # ğŸ’¾ å¸ƒå±€é…ç½®æ–‡ä»¶å

class AppState(BaseModel):
    # =================================
    #  ğŸ‰ åº”ç”¨çŠ¶æ€æ¨¡å‹ (æ— å‚æ•°)
    #
    #  ğŸ¨ ä»£ç ç”¨é€”ï¼š
    #     å®šä¹‰å‰ç«¯ä¼ é€’çš„æ•°æ®ç»“æ„ï¼Œç”¨äº Pydantic è‡ªåŠ¨æ ¡éªŒã€‚
    #
    #  ğŸ’¡ æ˜“æ‡‚è§£é‡Šï¼š
    #     è¿™æ˜¯ä¸€ä¸ªå¿«é€’ç›’ï¼ğŸ“¦ å‰ç«¯å‘æ¥çš„æ•°æ®å¿…é¡»è£…åœ¨è¿™ä¸ªç›’å­é‡Œï¼ŒAngel æ‰èƒ½ç­¾æ”¶å“¦ï¼
    # =================================
    data: dict # ğŸ“¦ åŒ…å«åº”ç”¨å¸ƒå±€ä¿¡æ¯çš„å­—å…¸

@router.post("/save_layout")
async def save_layout(state: AppState):
    # =================================
    #  ğŸ‰ ä¿å­˜å¸ƒå±€ (åº”ç”¨çŠ¶æ€)
    #
    #  ğŸ¨ ä»£ç ç”¨é€”ï¼š
    #     æ¥æ”¶å‰ç«¯å‘é€çš„æ¡Œé¢å¸ƒå±€æ•°æ®ï¼Œå¹¶è°ƒç”¨ FileManager æŒä¹…åŒ–å­˜å‚¨åˆ°ç£ç›˜ã€‚
    #
    #  ğŸ’¡ æ˜“æ‡‚è§£é‡Šï¼š
    #     Angel è®°æ€§å¾ˆå¥½çš„ï¼ğŸ§  ä½ æŠŠæ¡Œé¢æ‘†æˆä»€ä¹ˆæ ·ï¼Œæˆ‘éƒ½å¸®ä½ è®°ä¸‹æ¥ï¼Œä¸‹æ¬¡å¼€æœºè¿˜æ˜¯è€æ ·å­ï¼
    # =================================
    """ä¿å­˜è®°å¿†"""
    success = FileManager.save(DATA_FILE, state.data) # ğŸ’¾ ä¿å­˜åˆ°æ–‡ä»¶
    return {"status": "ok" if success else "error"} # ğŸ“¨ è¿”å›æ“ä½œç»“æœ

@router.get("/load_layout")
async def load_layout():
    # =================================
    #  ğŸ‰ è¯»å–å¸ƒå±€ (æ— å‚æ•°)
    #
    #  ğŸ¨ ä»£ç ç”¨é€”ï¼š
    #     ä»ç£ç›˜è¯»å–ä¹‹å‰ä¿å­˜çš„æ¡Œé¢å¸ƒå±€æ•°æ®ï¼Œè¿”å›ç»™å‰ç«¯ã€‚
    #
    #  ğŸ’¡ æ˜“æ‡‚è§£é‡Šï¼š
    #     æ¢å¤ç°åœºï¼âœ¨ å˜é­”æœ¯ä¸€æ ·ï¼ŒæŠŠä¸Šæ¬¡çš„æ¡Œé¢å˜å›æ¥ï¼
    # =================================
    """è¯»å–è®°å¿†"""
    return FileManager.load(DATA_FILE, default={}) # ğŸ“– è¯»å–æ–‡ä»¶å¹¶è¿”å›
