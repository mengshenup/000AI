# Windows 环境下 Angel Server 运行时潜在风险报告

## 1. 概述
除了端口冲突和进程残留外，Windows 控制台（CMD/PowerShell）的默认行为和系统电源策略可能会对长时间运行的服务器进程造成干扰。以下是详细的风险分析及解决方案。

## 2. 风险列表

### 2.1. 🖱️ 快速编辑模式 (Quick Edit Mode) - **高风险**
*   **现象**: 当鼠标点击控制台窗口内部（用于选择文本）时，窗口标题栏可能会出现“选择”或“Select”字样。此时，**整个服务器进程会被挂起（暂停）**，所有日志停止滚动，WebSocket 连接超时断开。只有按下 `Enter` 键后，进程才会恢复。
*   **原因**: Windows 控制台的默认特性，方便用户复制文本，但会阻塞标准输出流。
*   **解决方案**: 在启动脚本中通过 PowerShell 命令动态禁用当前窗口的快速编辑模式。

### 2.2. 💤 系统休眠/睡眠 (System Sleep) - **中风险**
*   **现象**: 当用户离开电脑一段时间后，服务器断连，无法访问。
*   **原因**: Windows 进入睡眠模式会切断网卡电源并暂停 CPU。
*   **解决方案**: 
    *   **临时**: 运行服务器时播放静音音频或使用 PowerToys Awake。
    *   **永久**: 在“电源选项”中将“使计算机进入睡眠状态”设置为“从不”。

### 2.3. 🔣 字符编码 (Encoding) - **低风险**
*   **现象**: 日志中的中文显示为乱码，或者 Python 报错 `UnicodeEncodeError`。
*   **原因**: CMD 默认编码为 GBK (cp936)，而现代 Python 程序通常输出 UTF-8。
*   **解决方案**: 
    *   脚本中执行 `chcp 65001` (已包含)。
    *   设置环境变量 `PYTHONIOENCODING=utf-8` (建议添加)。

### 2.4. 🛡️ 防火墙/杀毒软件干扰 - **低风险**
*   **现象**: 启动时弹出“Windows 安全中心警报”，或者连接被拒绝。
*   **原因**: Python 监听公网端口 (0.0.0.0) 会触发防火墙规则。
*   **解决方案**: 在弹出的防火墙提示中勾选“专用网络”和“公用网络”并允许访问。

## 3. 最佳修复方案 (已集成)

我将更新 `debug_start.bat`，加入以下增强功能：
1.  **自动禁用快速编辑模式**: 使用内嵌 PowerShell 脚本修改当前控制台句柄属性，防止鼠标点击暂停进程。
2.  **强制 UTF-8 编码**: 设置 Python 环境变量，确保日志绝对清晰。
3.  **增加缓冲区高度**: 防止日志跑太快被截断，方便回溯查看。

---
**更新后的脚本将自动处理上述 2.1 和 2.3 问题。**
