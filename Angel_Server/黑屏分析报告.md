# 🖥️ 黑屏问题分析报告

## 1. 问题描述
用户反馈在“探索之窗”中打开网页（如 Bilibili、抖音）时，虽然能看到网页的 UI 控件（如搜索框、按钮），但视频播放区域显示为全黑。

## 2. 可能原因分析

### A. 反爬虫机制 (Anti-Bot Detection)
*   **原理**：现代视频网站（尤其是抖音、B站）拥有极强的反爬虫系统。它们会检测浏览器指纹，如果发现是 Headless Chrome（无头浏览器），会拒绝分发视频流，或者返回一个空的视频容器。
*   **证据**：截图中 UI 加载正常，说明 HTML/CSS/JS 已执行，唯独视频流缺失，这是典型的媒体资源被拦截特征。

### B. 编解码器缺失 (Missing Codecs)
*   **原理**：Playwright 默认安装的 Chromium 是开源版本，出于版权原因，通常**不包含 H.264 (AVC) 和 AAC** 等专有媒体编解码器。而绝大多数商业视频网站都使用这些格式。
*   **后果**：浏览器无法解码视频流，导致播放器黑屏或显示错误。

### C. 硬件加速与 WebGL 问题
*   **原理**：在无头模式（Headless）下，GPU 硬件加速通常是关闭的。如果网页依赖 WebGL 或 Canvas 进行视频渲染（如某些弹幕播放器），可能会因为缺乏 GPU 上下文而渲染失败。

### D. 截图时机与渲染机制
*   **原理**：如果视频是通过 `<canvas>` 绘制的（为了防录屏），普通的 `page.screenshot()` 可能无法截取到 Canvas 的内容，或者需要特殊的参数配置。

## 3. 解决方案与建议

### ✅ 方案一：使用系统 Chrome (推荐)
改用系统安装的完整版 Google Chrome，而不是 Playwright 自带的 Chromium。完整版 Chrome 包含所有编解码器。
*   **操作**：在 `Angel_Server/services/browser.py` 中，取消注释 `channel="chrome"`，并确保服务器安装了 Chrome 浏览器。

### ✅ 方案二：伪装指纹 (Stealth Mode)
虽然代码中已经使用了 `--disable-blink-features=AutomationControlled`，但可能还不够。
*   **建议**：引入 `playwright-stealth` 库，更彻底地伪装浏览器指纹。

### ✅ 方案三：禁用无头模式 (Headful Mode)
如果服务器有桌面环境（如 Windows Server），可以将 `headless=True` 改为 `headless=False`。
*   **效果**：这是解决黑屏最直接的方法，因为有头模式下的渲染机制与真实用户完全一致。

### ✅ 方案四：强制软件解码
在启动参数中添加 `--disable-gpu` 和 `--disable-software-rasterizer`，或者尝试强制开启某些 flag，但这通常是“死马当活马医”。

## 4. 结论
当前最可能的原因为 **B (编解码器缺失)** 和 **A (反爬虫)**。建议优先尝试**方案一**，使用系统 Chrome 启动。
