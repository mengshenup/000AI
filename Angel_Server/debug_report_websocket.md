# WebSocket Handler 调试报告

## 1. 概述
对 `c:\000AI\Angel_Server\routers\websocket_handler.py` 进行了静态代码分析和逻辑审查。发现了一些潜在的性能问题、冗余代码以及异常处理不当的地方。

## 2. 问题列表

### 2.1. 冗余的服务启动调用
**位置**: `websocket_endpoint` 函数内。
**描述**: `browser_service.start()` 被调用了两次。
- 第一次: 在 `receiver_task` 创建之前 (Line 82)。
- 第二次: 在 `receiver_task` 创建之后 (Line 128)。
**影响**: 可能导致浏览器实例被重复初始化，浪费资源或引发未定义的行为。
**建议**: 删除第二次调用。

### 2.2. 帧率控制与命令接收的冲突
**位置**: 主循环中的 `asyncio.wait_for(queue.get(), timeout=0.05)` (Line 141)。
**描述**: 固定 `0.05` 秒 (50ms) 的超时时间与高帧率目标冲突。
- 如果目标 FPS 为 30 (间隔 ~33ms)，当没有命令时，循环会阻塞 50ms，导致实际帧率被限制在 20 FPS 以下。
**影响**: 视频流流畅度受限，无法达到 30 FPS。
**建议**: 动态计算 `timeout`，使其等于 `距离下一帧的时间`。

### 2.3. 异常处理过宽 (Bare Except)
**位置**: `send_packet` (Line 56) 和 `config_update` (Line 226)。
**描述**: 使用了 `except: pass`，吞掉了所有异常。
**影响**: 难以调试网络发送失败或配置解析错误的问题。
**建议**: 捕获具体异常或至少打印异常日志。

### 2.4. 未完成的代码块
**位置**: `jump_to` 处理块 (Line 310)。
**描述**: 代码中包含 `# ...existing code...` 注释，且没有实际逻辑。
**影响**: 发送 `jump_to` 指令时，除了获取时间戳外什么都不做。
**建议**: 补全逻辑，或将其映射到新的 `video_jump` 逻辑。

## 3. 修复计划
1.  删除冗余的 `browser_service.start()`。
2.  优化主循环的 `wait_for` 超时逻辑，实现精准帧率控制。
3.  完善 `jump_to` 逻辑 (兼容映射到 `angt_jump`)。
4.  增加异常日志输出。

